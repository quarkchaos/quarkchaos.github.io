<!doctype html>
<html class="theme-next use-motion ">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>



  
    <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  


<link rel="stylesheet" type="text/css" href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" />

<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.2"/>




  <meta name="keywords" content="gbs,tizen," />





  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />


<meta name="description" content="本文是 Tizen 系统的 gbs build 的用法的中英文对照版，主要内容为如何使用 gbs build 命令
Reference: https://source.tizen.org/documentation/reference/git-build-system/usage/gbs-build

gbs buildPUBLISHED 19 Oct 2014
By using ‘gbs bu">
<meta property="og:type" content="article">
<meta property="og:title" content="GBS Build">
<meta property="og:url" content="https://quarkchaos.github.com/2016/03/22/gbs-build/index.html">
<meta property="og:site_name" content="Jason Wang's Notes">
<meta property="og:description" content="本文是 Tizen 系统的 gbs build 的用法的中英文对照版，主要内容为如何使用 gbs build 命令
Reference: https://source.tizen.org/documentation/reference/git-build-system/usage/gbs-build

gbs buildPUBLISHED 19 Oct 2014
By using ‘gbs bu">
<meta property="og:updated_time" content="2016-03-22T13:39:20.612Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="GBS Build">
<meta name="twitter:description" content="本文是 Tizen 系统的 gbs build 的用法的中英文对照版，主要内容为如何使用 gbs build 命令
Reference: https://source.tizen.org/documentation/reference/git-build-system/usage/gbs-build

gbs buildPUBLISHED 19 Oct 2014
By using ‘gbs bu">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'always'
  };
</script>



<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?ea2c42d3a5f14cd212a7a74fe032f86d";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>

  <title> GBS Build | Jason Wang's Notes </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Jason Wang's Notes</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 

  <div id="posts" class="posts-expand">
    

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                GBS Build
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2016-03-22T21:21:47+08:00" content="2016-03-22">
              2016-03-22
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><blockquote>
<p>本文是 Tizen 系统的 gbs build 的用法的中英文对照版，主要内容为如何使用 gbs build 命令</p>
<p><em>Reference: <a href="https://source.tizen.org/documentation/reference/git-build-system/usage/gbs-build" target="_blank" rel="external">https://source.tizen.org/documentation/reference/git-build-system/usage/gbs-build</a></em></p>
</blockquote>
<h1 id="gbs-build"><a href="#gbs-build" class="headerlink" title="gbs build"></a>gbs build</h1><p>PUBLISHED 19 Oct 2014</p>
<p>By using ‘gbs build’, the developer can build the source code and generate rpm packages locally. For instructions on using the build subcommand, use this command: gbs build –help</p>
<blockquote>
<p>开发者可使用gbs build在本地编译源代码然后生成RPM包。使用命令 gbs build –help 可以获取关于子命令 build 的帮助指南</p>
</blockquote>
<pre><code>$ gbs build -h
</code></pre><h2 id="gbs-build-workflow-gbs-build-工作流程"><a href="#gbs-build-workflow-gbs-build-工作流程" class="headerlink" title="gbs build workflow (gbs build 工作流程)"></a>gbs build workflow (gbs build 工作流程)</h2><h3 id="Input-of-gbs-build-gbs-build的输入"><a href="#Input-of-gbs-build-gbs-build的输入" class="headerlink" title="Input of gbs build (gbs build的输入)"></a>Input of gbs build (gbs build的输入)</h3><p>Below is the input for gbs build:</p>
<blockquote>
<p>以下是 gbs build 所需输入：</p>
</blockquote>
<ul>
<li><p>git project(s) which contains rpm packaging files</p>
<blockquote>
<p>包含rpm packing文件的git项目</p>
</blockquote>
</li>
<li><p>binary rpm repositories (remote or local)</p>
<blockquote>
<p>二进制rpm包仓库</p>
</blockquote>
</li>
<li><p>project build configurations (macros, flags, etc)</p>
<blockquote>
<p>项目编译配置，宏定义、标志位等</p>
</blockquote>
</li>
</ul>
<p>The binary rpm repositories contain all the binary rpm packages which are used to create the chroot environment and build packages, which can be remote, like tizen release or snapshot repositories, or local repository. Local repository supports two types:</p>
<blockquote>
<p>二进制rpm包仓库包含所有rpm包，这些rpm包可以用来创建chroot环境和编译软件包。包仓库可以是远程的或者是本地的，远程的如Tizen的发布或快照仓库，本地仓库支持两种类型，如下：</p>
</blockquote>
<ul>
<li><p>A standard repository with repodata exists</p>
<blockquote>
<p>带repodata的标准仓库</p>
</blockquote>
</li>
<li><p>A normal directory contains RPM packages. GBS will find all RPM packages under this directory.</p>
<blockquote>
<p>包含RPM包的普通目录，GBS可以在此目录下找到所有的RPM包</p>
</blockquote>
</li>
</ul>
<p>Please refer to <a href="https://source.tizen.org/documentation/reference/git-build-system/configuration-file" target="_blank" rel="external">Configuration File</a> part to configure a repository.</p>
<blockquote>
<p>请参考<a href="https://source.tizen.org/documentation/reference/git-build-system/configuration-file" target="_blank" rel="external">配置文件</a>来配置一个软件包仓库</p>
</blockquote>
<h3 id="Build-workflow-编译流程"><a href="#Build-workflow-编译流程" class="headerlink" title="Build workflow (编译流程)"></a>Build workflow (编译流程)</h3><p>The input and output of gbs build are all repositories.</p>
<blockquote>
<p>gbs build的输入和输出都是仓库</p>
</blockquote>
<p><strong>Note</strong>: All the rpm packages under the output repository (by default, ~/GBS-ROOT/local/repos/&lt;VERSION&gt;/) will be used when building packages. That is, all the packages under the output repository will be applied to the build environment, so make sure the output repository is clean if you don’t want this behavior.</p>
<blockquote>
<p>注意：输出仓库（默认为~/GBS-ROOT/local/repos/&lt;VERSION&gt;/）下所有的rpm包将会被用于编译，如果你不希望使用这些包，请清理掉输出仓库中的rpm包。</p>
</blockquote>
<p>Here’s the basic gbs build workflow</p>
<blockquote>
<p>gbs build的基本流程</p>
</blockquote>
<pre><code> ____________________
|                    |      ___________
| Source Code (GIT)  |----&gt;|           |      _________________________
|____________________|     |           |     |                         |
 ____________________      |           |     |  Local repository of    |
|                    |     |           |     |                         |
|    Build config    |----&gt;| GBS build |----&gt;|                         |
|____________________|     |           |     |                         |
 ____________________      |           |     |  build RPM packages     |
|                    |     |           |     |(~/GBS-ROOT/local/repos/)|
|Binary repositories |     |           |     |_________________________|
|in GBS conf         |----&gt;|___________|                  |
|(Remote or Local)   |           ^                        |
|____________________|           |________________________|
</code></pre><p>From the above diagram, we can see the input and input are all repositories and the output repository located at ‘~/GBS-ROOT/locals/repos/‘ by default. You can change the repo path by using ‘–buildroot’ to specify a different build root.</p>
<blockquote>
<p>输出仓库默认为：<em>~/GBS-ROOT/local/repos</em>，可以通过 <strong>–buildroot</strong> 指定build root来改变仓库路径。</p>
</blockquote>
<p>Local repos in gbs build root (‘~/GBS-ROOT’ by default) will affect build results, so you must make sure that repos don’t contains old or unnecessary RPM packages. While running gbs build, you can specify ‘–clean-repos’ to clean up local repos, which gbs created, before building. We recommend that gbs users set different gbs build root directories for different profiles. There are several ways:</p>
<blockquote>
<p>gbs build root下的本地仓库会影响编译结果，所以你必须要保证仓库里没有旧的软件包或者无关的软件包。在编译的时候可以用 –clean-repos 选项在实际编译前清理 gbs 创建的本地仓库。建议 gbs 使用者针对不同的场景设置不同的 build root 目录。可以使用以下方法：</p>
</blockquote>
<ul>
<li><p>By default, the GBS build will put all output files under ~/GBS-ROOT/.</p>
<blockquote>
<p>GBS build默认会把所有的输出文件都放在 <em>~/GBS-ROOT/</em> 里</p>
</blockquote>
</li>
<li><p>If the environment variable TIZEN_BUILD_ROOT exists, ${TIZEN_BUILD_ROOT} will be used as output top dir</p>
<blockquote>
<p>如果存在环境变量 TIZEN_BUILD_ROOT，其值 $(TIZEN_BUILD_ROOT) 将会作为 build root</p>
</blockquote>
</li>
<li><p>If -B option is specified, then the specified directory is used, even if ${TIZEN_BUILD_ROOT} exists</p>
<blockquote>
<p>如果使用 -B 选项，那么就其参数将作为 build root ，即使环境变量 $(TIZEN_BUILD_ROOT) 存在</p>
</blockquote>
</li>
</ul>
<h3 id="Output-of-gbs-build-gbs-build-输出"><a href="#Output-of-gbs-build-gbs-build-输出" class="headerlink" title="Output of gbs build (gbs build 输出)"></a>Output of gbs build (gbs build 输出)</h3><p>Structure of a GBS build root directory</p>
<blockquote>
<p>GBS build root的目录结构</p>
</blockquote>
<pre><code>gbs output top dir
|-- local
| |-- cache # repodata and RPMs from remote repositories
| |-- repos # generated local repo top directory
| | |-- tizen # distro one: tizen
| | | |-- armv7l # store armv7l RPM packages
| | | |-- i586 # store x86 RPM packages
| | `-- tizen2.0 # build for distro two: tizen2.0
| | `-- i586 # the same as above
| |-- scratch.armv7l.0 # first build root for arm build
| |-- scratch.i586.0 # second build root for x86 build
| |-- scratch.i586.1 # third build root for x86 build
| |-- scratch.i586.2 # fourth build root for x86 build
| |-- scratch.i586.3 # fifth build root for x86 build
| | # The above build root dir can be used by gbs chroot &lt;build root dir&gt;
| `-- sources # sources generated for build, including tarball, spec, patches, etc.
| |-- tizen
| `-- tizen2.0
`-- meta # meta data used by gbs
</code></pre><h2 id="GBS-Build-Examples-Basic-Usage-GBS-Build示例，基本用法"><a href="#GBS-Build-Examples-Basic-Usage-GBS-Build示例，基本用法" class="headerlink" title="GBS Build Examples (Basic Usage) (GBS Build示例，基本用法)"></a>GBS Build Examples (Basic Usage) (GBS Build示例，基本用法)</h2><p>1 Build a single package.</p>
<blockquote>
<p>编译单个包</p>
</blockquote>
<pre><code>$ cd package1
$ gbs build -A i586
</code></pre><p>2 Build a package for different architectures.</p>
<blockquote>
<p>为不同的架构编译包</p>
</blockquote>
<p><strong>Note</strong>: Supported architectures include: x86_64, i586, armv6l, armv7hl, armv7l, aarch64, mips, mipsel.</p>
<blockquote>
<p>注意：支持的架构有： x86_64, i586, armv6l, armv7hl, armv7l, aarch64, mips, mipsel.</p>
</blockquote>
<pre><code>$ gbs build -A armv7l #build package for armv7l
$ gbs build -A i586 #build package for i586
</code></pre><p>3 Make a clean build by deleting the old build root. This option must be specified if the repo has been changed, for example, changed to another release.</p>
<blockquote>
<p>删除旧的build root，全新编译。当软件包仓库有变化时，必须使用这个选项，比如改成使用另一个发行版的软件仓库时.</p>
</blockquote>
<pre><code>$ gbs build -A armv7l --clean
</code></pre><p>4 Build the package with a specific commit.</p>
<blockquote>
<p>为特定提交编译包</p>
</blockquote>
<pre><code>$ gbs build -A armv7l --commit=&lt;COMMIT_ID&gt;
</code></pre><p>5 Use –overwrite to trigger a rebuild.</p>
<blockquote>
<p>用–overwrite触发一次重新编译</p>
</blockquote>
<p>If you have already built before, and want to rebuild, –overwrite should be specified, or the packages will be skipped.</p>
<blockquote>
<p>如果以前已经编译过，并且想重新编译，应该使用–overwrite，否则已经编过的包会被跳过</p>
</blockquote>
<pre><code>$ gbs build -A i586 --overwrite
</code></pre><p>If you change the commit or specify –include-all option, it will always rebuild, so –overwrite is not needed.</p>
<blockquote>
<p>如果有新提交或者带选项–include-all，则GBS总是会重新编译，此时滴必要使用–overwrite</p>
</blockquote>
<p>6 Output the debug info.</p>
<blockquote>
<p>输出调试信息</p>
</blockquote>
<pre><code>$ gbs build -A i586 --debug
</code></pre><p>7 Build against a local repository. You can config the local repo at .gbs.conf file or through the command line.</p>
<pre><code>$ gbs build -R /path/to/repo/dir/ -A i586
</code></pre><p>8 Use –noinit to build package in offline mode.</p>
<blockquote>
<p>使用 –noinit 选项，在离线模式下编译</p>
</blockquote>
<p>–noinit option can only be used if build root is ready. With –noinit option, gbs will not connect the remote repo, and skip parsing &amp; checking repo and initialize build environment. rpmbuild will be used to build the package directly. Here’s an example:</p>
<blockquote>
<p>在build root准备好的情况下，可以使用选项 –noinit。使用 –noinit 选项时，gbs不会连接远程仓库并且会跳过解析/检查仓库和初始化编译环境，直接使用rpmbuild编译包. </p>
<p><strong>重要</strong>：此选项可用于快速编译</p>
</blockquote>
<pre><code>$ gbs build -A i586 # build first and create build environment
$ gbs build -A i586 --noinit # use --noinit to start building directly
</code></pre><p>9 Build with all uncommitted changes using –include-all.</p>
<blockquote>
<p>使用 –include-all 选项编译所有的未提交的改动</p>
<p><strong>重要</strong>，此选项为常用选项，当用户本地有修改又没有提交时，经常需要使用此选项用于测试新代码</p>
</blockquote>
<p>For example, the git tree contains one modified file and two extra files:</p>
<blockquote>
<p>例如，git目录中包含一个改动的文件和二个新加的文件</p>
</blockquote>
<pre><code>$ git status -s
M ail.pc.in
?? base.repo
?? main.repo
</code></pre><p><strong>Build without the –include-all option</strong></p>
<blockquote>
<p>不用–include-all编译</p>
</blockquote>
<p>Builds committed files only. All the modified files, which are not committed nor added, will NOT be built:</p>
<blockquote>
<p>仅编译已提交的文件。所有未提交或未添加到版本控制的文件都不会被编译:</p>
</blockquote>
<pre><code>$ gbs build -A i586
warning: the following untracked files would NOT be included: base.repo main.repo
warning: the following uncommitted changes would NOT be included: ail.pc.in
warning: you can specify &apos;--include-all&apos; option to include these uncommitted and untracked files.
....
info: Binaries RPM packages can be found here:
/home/test/GBS-ROOT/local/scratch.i586.0/home/abuild/rpmbuild/RPMS/
info: Done
</code></pre><p><strong>Build with the –include-all option builds all the files</strong></p>
<blockquote>
<p>使用–include-all来编译所有的文件</p>
</blockquote>
<pre><code>$ gbs build -A i586 --include-all
info: the following untracked files would be included: base.repo main.repo
info: the following un-committed changes would be included: ail.pc.in
info: export tar ball and packaging files
...
...
[build finished]
</code></pre><p><strong>Use .gitignore to ignore specific files, when using the –include-all option.</strong></p>
<blockquote>
<p>当使用–incldue-all时可以用.gitignore来忽略特定的文件</p>
</blockquote>
<p>If you want to ignore some files types, you can update your .gitignore. For example:</p>
<blockquote>
<p>如果要想忽略某类型文件可以修改.gitignore，例如：</p>
</blockquote>
<pre><code>$ cat .gitignore
.*
*/.*
*.pyc
*.patch*
</code></pre><h2 id="Incremental-build"><a href="#Incremental-build" class="headerlink" title="Incremental build"></a>Incremental build</h2><blockquote>
<p>增量编译</p>
</blockquote>
<h3 id="Incremental-Concept"><a href="#Incremental-Concept" class="headerlink" title="Incremental Concept"></a>Incremental Concept</h3><blockquote>
<p>增量的概念</p>
</blockquote>
<p>Starting from gbs 0.10, the gbs build subcommand supports building incrementally, which can be enabled by specifying the ‘–incremental’ option.</p>
<blockquote>
<p>从gbs 0.10开始，gbs build就支持增量式的编译，通过指定–incremental选项来启用。</p>
</blockquote>
<p>This mode is designed for development and verification of single packages. It is not intended to replace the standard mode. Only one package can be built at a time using this mode.</p>
<blockquote>
<p>这种模式主要用来开发和验证单个软件包，不是用来替代标准的编译模式。在此模式下，一次只能编译一个包。</p>
</blockquote>
<p>This mode will set up the build environment in multiple steps, finishing by mounting the local Git tree of a package in the chroot build environment.</p>
<blockquote>
<p>这种模式分成多步来设置编译环境，把本地的软件包的Git目录绑定到chroot的编译目录后就完成了。</p>
</blockquote>
<p>Note: Because gbs will mount your git tree to the build root, be very careful when you remove your build root. You need to make sure you’ve already umounted the source tree manually before you remove it.</p>
<blockquote>
<p>注意：因为gbs会把git目录绑定到buid root，所以当要删除build root时要非常小心，删除前要确定已经手动地把源码解绑定。</p>
</blockquote>
<p>This has the following benefits:</p>
<blockquote>
<p>这种模式有以下优点：</p>
</blockquote>
<ul>
<li><p>The build environment uses the latest source code and changes to source do not trigger a new build environment (in the chroot).</p>
<blockquote>
<p>编译环境可以使用最新的源代码，并且代码的改动不会修改编译环境</p>
</blockquote>
</li>
<li><p>The Git source tree becomes the source of the builds. Any change made in the Git repository followed by invocation of the build script will build the changed sources</p>
<blockquote>
<p>git目录变成了编译的源目录，只要在git中的任何改动之后，调用编译命令，就可以编译改动过的源代码</p>
</blockquote>
</li>
<li><p>If the build fails for some reason, the build script will continue from the spot where it has failed, once the code has been changed to fix the problem causing the failure.</p>
<blockquote>
<p>编译失败后，一旦导致编译失败的错误被修正，编译脚本会从先前失败的地方接着编译</p>
</blockquote>
</li>
</ul>
<p>This mode is, in many ways, similar to traditional code development, where changes are made to sources, followed by running make to test and compile the changes. However, it enables development using the build environment of the target, instead of the host OS.</p>
<blockquote>
<p>从不同的方面说，这种模式类似于传统的代码开发：修改代码然后运行make编译改动。不同的地方在于，增量编译使用编译环境而不是宿主机器的操作系统</p>
</blockquote>
<p>This method has some limitations, mostly related to packaging and how the sources are maintained. Among others, it depends on how the RPM spec file is composed:</p>
<blockquote>
<p>这种模式有一些限制，都是关于打包和代码的管理。尤其是依赖于RPM的spec文件</p>
</blockquote>
<ul>
<li><p>It does not support patches in the spec file. All source has to be maintained as part of the Git tree</p>
<blockquote>
<p>不支持spec文件中的patches，所有的源码必须是git目录的一部分</p>
</blockquote>
</li>
<li><p>It requires a clean packaging workflow. Exotic workflows in the spec files might not work well, because this mode expects the following model:</p>
<blockquote>
<p>需要一个整洁的打包流程。spec文件中的极特殊的流程可能不会有效，因为这种模式预期以下模型：</p>
</blockquote>
<ol>
<li>Code preparation (%prep) （代码准备）</li>
<li>Code building (%build) （代码编译）</li>
<li>Code installation (%install) （代码安装）</li>
</ol>
</li>
</ul>
<ul>
<li><p>Because we run the %build section every time, if the %build script has configuration scripts (auto-tools), binaries might be regenerated, causing a complete build every time. To avoid this, you are encouraged to use the following macros, which can be overridden using the –no-configure option:</p>
<blockquote>
<p>因为每次都运行编译部分，如果%build脚本有自动配置脚本，二进制文件会被重新生成，导致每次都完全编译。为了避免这样情况发生，推荐使用下面的宏，这些宏能够用–no-configure选项来覆盖</p>
</blockquote>
<ol>
<li>%configure: runs the configure script with pre-defined paths and options.</li>
<li>%reconfigure: regenerates the scripts and runs %configure</li>
<li>%autogen: runs the autogen script</li>
</ol>
</li>
</ul>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>In this example, we use dlog source code. First, we need to build with –incremental, then just modify one source file, and trigger the incremental build again. We will see that only modified source code has been compiled during the incremental build.</p>
<pre><code>$ cd dlog
# first build:
$ gbs build -A i586 --incremental
$ vim log.c # change code
# second build:
$ gbs build -A i586 --incremental
info: generate repositories ...
info: build conf has been downloaded at:
/var/tmp/test-gbs/tizen.conf
info: Start building packages from: /home/test/packages/dlog (git)
info: Prepare sources...
info: Retrieving repo metadata...
info: Parsing package data...
info: *** overwriting dlog-0.4.1-5.1 i586 ***
info: Next pass:
dlog
info: *** building dlog-0.4.1-5.1 i586 tizen (worker: 0) ***
info: Doing incremental build
[ 0s] Memory limit set to 10854336KB
[ 0s] Using BUILD_ROOT=/home/test/GBS-ROOT/local/scratch.i586.0
[ 0s] Using BUILD_ARCH=i686:i586:i486:i386:noarch
[ 0s] test-desktop started &quot;build dlog.spec&quot; at Thu Sep 13 07:36:14 UTC 2012.
[ 0s] -----------------------------------------------------------------
[ 0s] ----- building dlog.spec (user abuild)
[ 0s] -----------------------------------------------------------------
[ 0s] -----------------------------------------------------------------
[ 0s] + rpmbuild --short-circuit -bc /home/abuild/rpmbuild/SOURCES/dlog.spec
[ 0s] Executing(%build): /bin/sh -e /var/tmp/rpm-tmp.XLz8je
[ 0s] + umask 022
[ 0s] + export LD_AS_NEEDED
[ 4s] + make -j4
[ 4s] make all-am
[ 4s] make[1]: Entering directory /home/abuild/rpmbuild/BUILD/dlog-0.4.1
[ 4s] /bin/sh ./libtool --tag=CC --mode=compile gcc -c -o log.lo log.c
[ 4s] mv -f .deps/log.Tpo .deps/log.Plo
[ 4s] /bin/sh ./libtool --tag=CC --mode=link gcc -o libdlog.la /usr/lib log.lo
[ 4s] libtool: link: gcc -shared .libs/log.o -o .libs/libdlog.so.0.0.0
[ 4s] libtool: link: ar cru .libs/libdlog.a log.o
[ 4s] libtool: link: ranlib .libs/libdlog.a
[ 4s] make[1]: Leaving directory /home/abuild/rpmbuild/BUILD/dlog-0.4.1
[ 4s] + exit 0
[ 4s] finished &quot;build dlog.spec&quot; at Thu Sep 13 07:36:18 UTC 2012.
[ 4s]
info: finished incremental building dlog
info: Local repo can be found here:
/home/test/GBS-ROOT/local/repos/tizen/
info: Done
</code></pre><p>From the buildlog, we can see that only log.c has been re-compiled. That’s the incremental build behavior.</p>
<p>–noinit option can be used together with –incremental to make a build more quickly, like:</p>
<pre><code>$ gbs build --incremental --noinit
</code></pre><h3 id="Limitations-of-Incremental-Build"><a href="#Limitations-of-Incremental-Build" class="headerlink" title="Limitations of Incremental Build"></a>Limitations of Incremental Build</h3><blockquote>
<p>增量编译的限制</p>
</blockquote>
<p>Incremental build doesn’t support all packages. Here are some limitations:</p>
<blockquote>
<p>增量编译不支持所有的包。一些限制如下:</p>
</blockquote>
<ul>
<li><p>Incremental build currently supports building only a single package. It doesn’t support building multiple packages in parallel</p>
<blockquote>
<p>只支持单个包</p>
</blockquote>
</li>
<li><p>The tarball’s name in the spec file should be %{name}-%{version}.{tar.gz|tar.bz2|zip|…}, otherwise GBS can’t mount source code to build the root correctly</p>
<blockquote>
<p>spec文件中的压缩包名字必须是%{name}-%{version}.{tar.gz|tar.bz2|zip|…}，否则GBS无法正确把源码绑定到build root中</p>
</blockquote>
</li>
<li><p>%prep section should only contains %setup macro to unpack tarball, and should not contains other source code related operations, such as unpack another source, apply patches, etc.</p>
<blockquote>
<p>%prep部分应该仅包含用于解圧压缩包的%setup宏，而不应该含有对源代码的其他操作，比如解压其他源码或打patch等都不允许</p>
</blockquote>
</li>
</ul>
<h2 id="Multiple-packages-build-dependency-build-多包编译"><a href="#Multiple-packages-build-dependency-build-多包编译" class="headerlink" title="Multiple packages build (dependency build) (多包编译)"></a>Multiple packages build (dependency build) (多包编译)</h2><p>Multiple package build has been supported since gbs 0.10. If packages have dependencies on each other, gbs will build packages in the correct order calculated by dependency relationship. Previously built out RPMs will be used to build the following packages that depend on them, which is the dependency build.</p>
<blockquote>
<p>从gbs 0.10开始就支持多包编译。如果包有相互的依赖，gbs会计算出它们之间的关系然后按正确的顺序来编译。作为依赖编译，先前编译出的RPM包会用来编译后面的有依赖需求的包</p>
</blockquote>
<p>Examples:</p>
<p>1 Build all packages under a specified package directory</p>
<blockquote>
<p>编译指定目录下的所有的包</p>
</blockquote>
<pre><code>$ mkdir tizen-packages
$ cp package1 package2 package3 ... tizen-packages/
$ gbs build -A i586 tizen-packages # build all packages under tizen-packages
</code></pre><p>2 Build multiple packages in parallel with –threads</p>
<blockquote>
<p>使用–threads选项来并行编译多个包</p>
</blockquote>
<pre><code># current directory have multiple packages, --threads can be used to set the max build worker at the same time
$ gbs build -A armv7l --threads=4
</code></pre><p>3 Select a group of packages to be built</p>
<blockquote>
<p>选择编译一组包</p>
</blockquote>
<p>The –binary-from-file option specifies a text file that contains a name list of RPM packages to be built. The format in the text file is one package per line.</p>
<p>The –binary-list option specifies a list in which the package names are separated by comma.</p>
<p>When the number of packages is small, thus the packages can be clearly presented in command line, it is recommended to use the –binary-list option for simplicity.</p>
<pre><code>$ gbs build -A i586 --binary-from-file=/path/to/packages.list
$ gbs build -A i586 --binary-list=&lt;pkg1&gt;,&lt;pkg2&gt;
</code></pre><p>4 Exclude certain packages.</p>
<blockquote>
<p>排除某些包</p>
</blockquote>
<p>The –exclude option specifies a list in which the names of packages to be ignored are separated by comma. The –exclude-from-file option specifies a text file that contains a name list of packages to be ignored.</p>
<pre><code>$ gbs build -A i586 tizen-packages --exclude=&lt;pkg1&gt;
$ gbs build -A i586 tizen-packages --exclude=&lt;pkg1&gt;,&lt;pkg2&gt;
$ gbs build -A i586 tizen-packages --exclude-from-file=/path/to/packages.list
</code></pre><p>5 Build packages based on dependencies.</p>
<blockquote>
<p>基于依赖来编译包</p>
</blockquote>
<p>The –deps option enables GBS to build specific packages, together with all the related packages on which they depend.The –rdep option enables GBS to build specific packages, together with all the related packages that depend on them.</p>
<p>The specific packages can be included by the –binary-from-file option or the –binary-list option, and be excluded by the –exclude option or the –exclude-from-file option.</p>
<p>These two options are compatible. When added at the same time, besides the specific packages, GBS will build not only the related packages on which they depend, but also all the related packages that depend on them.</p>
<pre><code>$ gbs build -A i586 --binary-list=&lt;pkg1&gt;,&lt;pkg2&gt; --deps
$ gbs build -A i586 --binary-list=&lt;pkg1&gt;,&lt;pkg2&gt; --rdeps
$ gbs build -A i586 --binary-list=&lt;pkg1&gt;,&lt;pkg2&gt; --deps --rdeps
</code></pre><h2 id="Other-useful-options-其他有用的选项"><a href="#Other-useful-options-其他有用的选项" class="headerlink" title="Other useful options (其他有用的选项)"></a>Other useful options (其他有用的选项)</h2><h3 id="Install-extra-packages-to-build-root"><a href="#Install-extra-packages-to-build-root" class="headerlink" title="Install extra packages to build root"></a>Install extra packages to build root</h3><blockquote>
<p>安装额外的包到build root中</p>
</blockquote>
<p>–extra-packs=<pkgs list="" sep="" by="" comma=""> can be used to install extra packages:</pkgs></p>
<pre><code>$ gbs build --extra-packs=vim,zypper,gcc,gdb ...
</code></pre><h3 id="Keep-all-packages-in-build-root"><a href="#Keep-all-packages-in-build-root" class="headerlink" title="Keep all packages in build root"></a>Keep all packages in build root</h3><blockquote>
<p>保留所有build root中的包</p>
</blockquote>
<p>Generally, gbs build will remove unnecessary packages in build root. While transferring to build another package, you can use –keep-packs to keep all unnecessary packages, and just install missing build required packages. This option can be used to speed up build multiple packages.</p>
<blockquote>
<p>通常情况下，gbs build会把build root中的不需要的包删除掉。当要编译另外的包时可以使用–keep-packs选项来保留不再需要的包而只安装缺失的依赖包。这个选项可以加速多个包的编译。</p>
<p><strong>重要</strong>：重要选项，可以节省编译时间</p>
</blockquote>
<pre><code>$ gbs build --keep-packs
</code></pre><p>–keep-packs can be used to create one build root for building multiple packages. Once the build root is ready, you can use –noinit to build these packages quickly.</p>
<blockquote>
<p>–keep-packs选项可以用来为多个包创建一个build root。一旦build root准备好，就可以用 –noinit 选项来快速的编译这些包</p>
<p><strong>重要</strong>：–keep-packs 配合 –noinit，可以节省编译时间</p>
</blockquote>
<pre><code>$ gbs build pkg1/ --keep-packs -A i586
$ gbs build pkg2/ --keep-packs -A i586
$ gbs build pkg3/ --keep-packs -A i586
</code></pre><p>Now, the build root (~/GBS-ROOT/local/scratch.i586.0) is ready for building pkg1, pkg2, and pkg3. You can use –noinit to build them offline, and don’t need waste time to check repo updates and build root.</p>
<pre><code>$ gbs build pkg1 --noinit
$ gbs build pkg2 --noinit
$ gbs build pkg3 --noinit
</code></pre><h2 id="Fetch-the-project-build-conf-and-customize-build-root-for-Advanced-Users-（高级用户，获取项目的编译配置和定制build-root）"><a href="#Fetch-the-project-build-conf-and-customize-build-root-for-Advanced-Users-（高级用户，获取项目的编译配置和定制build-root）" class="headerlink" title="Fetch the project build conf and customize build root (for Advanced Users) （高级用户，获取项目的编译配置和定制build root）"></a>Fetch the project build conf and customize build root (for Advanced Users) （高级用户，获取项目的编译配置和定制build root）</h2><p>Project build conf describes the project build configurations for the project, including pre-defined macros/packages/flags in the build environment. In Tizen releases, the build conf is released together with the released repo. You can find an example at: <a href="http://download.tizen.org/releases/daily/trunk/ivi/latest/builddata/xxx-build.conf" target="_blank" rel="external">http://download.tizen.org/releases/daily/trunk/ivi/latest/builddata/xxx-build.conf</a></p>
<pre><code>gbs build will fetch the build conf automatically
</code></pre><p>Starting from gbs 0.7.1, by default, gbs will fetch the build conf from a remote repo, if you specify the remote Tizen repo, and then store it in your temp environment. Here’s the build log:</p>
<pre><code>$ gbs build -A i586
info: generate repositories ...
info: build conf has been downloaded at:
/var/tmp/&lt;user&gt;-gbs/tizen2.0.conf
info: generate tar ball: packaging/acpid-2.0.14.tar.bz2
[sudo] password for &lt;user&gt;:

build the package using your own project build conf, using the -D option
</code></pre><p>You can save it and modify it, and then use it for your purposes:</p>
<pre><code>cp /var/tmp/&lt;user&gt;-gbs/tizen2.0.conf ~/tizen2.0.conf
$ gbs build -A i586 -D ~/tizen2.0.conf
</code></pre><p>If you need to customize the build config, refer to: <a href="http://en.opensuse.org/openSUSE:Build_Service_prjconf" target="_blank" rel="external">http://en.opensuse.org/openSUSE:Build_Service_prjconf</a></p>
<p><em>Reference: <a href="https://source.tizen.org/documentation/reference/git-build-system/usage/gbs-build" target="_blank" rel="external">https://source.tizen.org/documentation/reference/git-build-system/usage/gbs-build</a></em></p>
</span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/gbs/" rel="tag">#gbs</a>
          
            <a href="/tags/tizen/" rel="tag">#tizen</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/03/13/setup-proxy-for-node-gyp/" rel="next" title="node-gyp 设置 Proxy">
                <i class="fa fa-chevron-left"></i> node-gyp 设置 Proxy
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/03/24/introduction-of-json/" rel="prev" title="Introduction of JSON">
                Introduction of JSON <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

 </div>

        

        
          <div class="comments" id="comments">
            
          </div>
        
      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table Of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Jason Wang" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Jason Wang</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">9</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">categories</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">12</span>
              <span class="site-state-item-name">tags</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#gbs-build"><span class="nav-number">1.</span> <span class="nav-text">gbs build</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#gbs-build-workflow-gbs-build-工作流程"><span class="nav-number">1.1.</span> <span class="nav-text">gbs build workflow (gbs build 工作流程)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Input-of-gbs-build-gbs-build的输入"><span class="nav-number">1.1.1.</span> <span class="nav-text">Input of gbs build (gbs build的输入)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Build-workflow-编译流程"><span class="nav-number">1.1.2.</span> <span class="nav-text">Build workflow (编译流程)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Output-of-gbs-build-gbs-build-输出"><span class="nav-number">1.1.3.</span> <span class="nav-text">Output of gbs build (gbs build 输出)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GBS-Build-Examples-Basic-Usage-GBS-Build示例，基本用法"><span class="nav-number">1.2.</span> <span class="nav-text">GBS Build Examples (Basic Usage) (GBS Build示例，基本用法)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Incremental-build"><span class="nav-number">1.3.</span> <span class="nav-text">Incremental build</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Incremental-Concept"><span class="nav-number">1.3.1.</span> <span class="nav-text">Incremental Concept</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Example"><span class="nav-number">1.3.2.</span> <span class="nav-text">Example</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Limitations-of-Incremental-Build"><span class="nav-number">1.3.3.</span> <span class="nav-text">Limitations of Incremental Build</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Multiple-packages-build-dependency-build-多包编译"><span class="nav-number">1.4.</span> <span class="nav-text">Multiple packages build (dependency build) (多包编译)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Other-useful-options-其他有用的选项"><span class="nav-number">1.5.</span> <span class="nav-text">Other useful options (其他有用的选项)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-extra-packages-to-build-root"><span class="nav-number">1.5.1.</span> <span class="nav-text">Install extra packages to build root</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Keep-all-packages-in-build-root"><span class="nav-number">1.5.2.</span> <span class="nav-text">Keep all packages in build root</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Fetch-the-project-build-conf-and-customize-build-root-for-Advanced-Users-（高级用户，获取项目的编译配置和定制build-root）"><span class="nav-number">1.6.</span> <span class="nav-text">Fetch the project build conf and customize build root (for Advanced Users) （高级用户，获取项目的编译配置和定制build root）</span></a></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason Wang</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    
    

  


  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.2" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.2" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    var $tocContent = $('.post-toc-content');
    if (isDesktop() && CONFIG.sidebar === 'post') {
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
        displaySidebar();
      }
    }
  });
</script>



  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }

      motionIntegrator.bootstrap();
    });
  </script>

  
  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
